#!/usr/bin/env ruby
# coding: utf-8

$:.unshift File.join(File.dirname(__FILE__), '..', 'lib')

require 'tres'
require 'colorize'

ACTIONS = {
  :server   => %w(server),
  :new_at   => %w(new),
  :init     => %w(init start)
}

def bail! reason
  puts reason
  exit -2
end

def figure_what_to_do!
  help_and_exit! if ARGV.empty?
  if ACTIONS.values.flatten.include? ARGV.first
    action = ACTIONS.select { |action, args| args.include? ARGV.first }.flatten.first
    send action, *ARGV[1..(ARGV.length - 1)]
  else
    help_and_exit!
  end
end

def help_and_exit!
  STDERR.puts <<-HELP
Tres 
  Usage:
    tres new <directory>
  Example:
    tres new myapp
  Other commands:
    help        shows this menu
    version     shows the current version of Tres you have installed
  HELP
  exit -1
end

def new_at dir
  Tres.say_progress "    â†’ Creating Tres app on #{dir.dup.colorize(:yellow)}  " do
    Tres::App.new dir
  end
end

def server
end

def init
end


figure_what_to_do!